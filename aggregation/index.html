



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Marcus D. R. Klarqvist">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Aggregation - Tomahawk</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#aggregating-datasets" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Tomahawk" class="md-header-nav__button md-logo">
          
            <img src="../images/twk_logo_white.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Tomahawk
              </span>
              <span class="md-header-nav__topic">
                Aggregation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/mklarqvist/tomahawk/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Tomahawk" class="md-nav__button md-logo">
      
        <img src="../images/twk_logo_white.svg" width="48" height="48">
      
    </a>
    Tomahawk
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/mklarqvist/tomahawk/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Technical details
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Technical details
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../algorithm-overview/" title="Algorithm overview" class="md-nav__link">
      Algorithm overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Aggregation
      </label>
    
    <a href="./" title="Aggregation" class="md-nav__link md-nav__link--active">
      Aggregation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" title="Motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#existing-solutions" title="Existing solutions" class="md-nav__link">
    Existing solutions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation" title="Aggregation" class="md-nav__link">
    Aggregation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-balancing/" title="Job balancing" class="md-nav__link">
      Job balancing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../r-tutorial/" title="R" class="md-nav__link">
      R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker-tutorial/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Command line interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Command line interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-aggregate/" title="aggregate" class="md-nav__link">
      aggregate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-calc/" title="calc" class="md-nav__link">
      calc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-concat/" title="concat" class="md-nav__link">
      concat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-import/" title="import" class="md-nav__link">
      import
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-sort/" title="sort" class="md-nav__link">
      sort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-view/" title="view" class="md-nav__link">
      view
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-haplotype/" title="haplotype" class="md-nav__link">
      haplotype
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/cli-decay/" title="decay" class="md-nav__link">
      decay
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api-documentation/" title="API documentation" class="md-nav__link">
      API documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../developer-documentation/" title="Developer documentation" class="md-nav__link">
      Developer documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" title="Motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#existing-solutions" title="Existing solutions" class="md-nav__link">
    Existing solutions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation" title="Aggregation" class="md-nav__link">
    Aggregation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/mklarqvist/tomahawk/edit/master/docs/aggregation.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="aggregating-datasets">Aggregating datasets<a class="headerlink" href="#aggregating-datasets" title="Permanent link">&para;</a></h1>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/mklarqvist/tomahawk">Tomahawk</a> generally output many
millions to many hundreds of millions, or even billions, of output linkage
disequilibrium (LD) associations generated from many millions of input SNVs. It
is technically very challenging to visualize such large datasets. Not only
because of hardware limitations such as loading all the data into memory, or
directly rendering billions of data points, but also because of more practical
considerations such as cramming such a vast number of data points into a finite
number of pixels would result in an absolute horrendous and uninformative image.</p>
<p>In order to get a scope of the scale this problem presents, take for example a
small chromosome like <code>chr20</code> with data from the 1000 Genomes Project Phase 3
(1KGP3). This data comprises of 1,733,484 diploid SNVs. Assuming we can plot the
LD data for a pair of SNVs in a single pixel, a monitor would have to have the
dimensions 400 x 400 meters to display this data*! Not only would the monitor
have to be huge, the memory requirement for plotting this image would be around
400 GB! Here we describe methods to overcome these obstacles.</p>
<p>* Assuming a 1920 x 1080 pixel resolution and 20" monitor as reference</p>
<h2 id="existing-solutions">Existing solutions<a class="headerlink" href="#existing-solutions" title="Permanent link">&para;</a></h2>
<p>There are several existing solutions for aggregating large datasets, such as
<a href="http://datashader.org/">Datashader</a> for Python users. But packages like this
requires us to leave the highly compressed internal binary representation of
Tomahawk in order to transform <code>two</code> records into a form understandable by these
frameworks. We have tried several of the most popular framework for aggregating
datasets and found none that works in reasonable memory and is sufficiently
efficient when applied to our specific use-case.</p>
<h2 id="aggregation">Aggregation<a class="headerlink" href="#aggregation" title="Permanent link">&para;</a></h2>
<p>Aggregation is the process of reducing larger datasets to smaller ones for the
purposes of displaying more data than can fit on the screen at once while
maintaining the primary features of the original dataset. Tomahawk performs
aggregation into regular grids (two-dimensional partitions) by applying summary
statistics function on data collected in the given bins. At the moment, Tomahawk
supports aggregation by</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Summation</td>
<td>Sum total of the desired property</td>
</tr>
<tr>
<td>Summation squared</td>
<td>Sum total of squares of the desired property</td>
</tr>
<tr>
<td>Mean</td>
<td>Mean of the desired property</td>
</tr>
<tr>
<td>Standard deviation</td>
<td>Standard deviation of the desired property</td>
</tr>
<tr>
<td>Minimum</td>
<td>Smallest value observed of the desired property</td>
</tr>
<tr>
<td>Maximum</td>
<td>Largest value oserved of the desired property</td>
</tr>
<tr>
<td>Count</td>
<td>Number of times a non-zero value is observed of the desired property</td>
</tr>
</tbody>
</table>
<p>Without losing generality, imagine we start out with this 4x4 matrix of
observations and we want to plot 4 pixels (2 x 2).</p>
<table>
<thead>
<tr>
<th></th>
<th>C1</th>
<th>C2</th>
<th>C3</th>
<th>C4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1</strong></td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td><strong>R2</strong></td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
</tr>
<tr>
<td><strong>R3</strong></td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
</tr>
<tr>
<td><strong>R4</strong></td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>Aggregation by summation</p>
<table>
<thead>
<tr>
<th></th>
<th>C1-2</th>
<th>C3-4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1-2</strong></td>
<td>14</td>
<td>22</td>
</tr>
<tr>
<td><strong>R3-4</strong></td>
<td>46</td>
<td>54</td>
</tr>
</tbody>
</table>
<p>Aggregation by mean</p>
<table>
<thead>
<tr>
<th></th>
<th>C1-2</th>
<th>C3-4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1-2</strong></td>
<td>3.5</td>
<td>5.5</td>
</tr>
<tr>
<td><strong>R3-4</strong></td>
<td>11.5</td>
<td>13.5</td>
</tr>
</tbody>
</table>
<p>Aggregation by min</p>
<table>
<thead>
<tr>
<th></th>
<th>C1-2</th>
<th>C3-4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1-2</strong></td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td><strong>R3-4</strong></td>
<td>9</td>
<td>11</td>
</tr>
</tbody>
</table>
<p>Aggregation by max</p>
<table>
<thead>
<tr>
<th></th>
<th>C1-2</th>
<th>C3-4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1-2</strong></td>
<td>6</td>
<td>8</td>
</tr>
<tr>
<td><strong>R3-4</strong></td>
<td>14</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>Aggregation by count</p>
<table>
<thead>
<tr>
<th></th>
<th>C1-2</th>
<th>C3-4</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1-2</strong></td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td><strong>R3-4</strong></td>
<td>4</td>
<td>4</td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../algorithm-overview/" title="Algorithm overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Algorithm overview
              </span>
            </div>
          </a>
        
        
          <a href="../job-balancing/" title="Job balancing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Job balancing
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (C) 2016-present Genome Research Ltd., University of Cambridge, and Marcus D. R. Klarqvist
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b3a2063f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>